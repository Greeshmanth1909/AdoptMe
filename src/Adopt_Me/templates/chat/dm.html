{% extends 'base.html' %}

{% load static %}

{% block content %}
 <div>
    <h1 id="receiver">{{ receiver }}</h1>
 </div>
    {% for message in old_messages %}
    <p>{{ message.sender }}</p>
        {% if message.sender == user %}
            <!-- msgs form self -->
            <div>
                <p>
                    {{message.message}}
                </p>
            </div>

        {% else %}
            <!-- to the left -->
            <div>
                <h1>
                    {{message.message}}
                </h1>
            </div>
        {% endif %}
    {% endfor %}

    <form method="post" id="chat-form">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Send</button>
    </form>

    <script>
        const username = document.getElementById('receiver').innerHTML
        console.log(username);
        let ws_url = `ws://127.0.0.1:8000/ws/chats/${username}/`
        console.log(ws_url);
        const socket = new WebSocket(ws_url);
        
        socket.onopen = function hello(){
            console.log("connection successfull!")
        }

        socket.onmessage = function msg(event){
            var data = JSON.parse(event.data);
            console.log(data);
        }

        socket.onclose = function close(){
            console.log("connection closed");
        }

        socket.onerror = function err(){
            console.log("an unexpected error occured..")
        }

    </script>
{% endblock %}